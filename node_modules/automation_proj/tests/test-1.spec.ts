import { test, expect } from '@playwright/test';
import { LoginPage } from '../pages/loginPage';
import { DashboardPage } from '../pages/dashboardPage';
import { ProjectPage } from '../pages/projectPage';
import { generateRandomName, generateRandomProjectNumber } from '../utils/helpers';

test('Should allow create project using NEC', async ({ page }) => {
  const loginPage = new LoginPage(page);
  const dashboardPage = new DashboardPage(page);
  const projectPage = new ProjectPage(page);

  // Generar datos aleatorios para el proyecto
  const projectName = generateRandomName();
  const projectNumber = generateRandomProjectNumber();
  const projectDate = '02/28/2025'; 

  // **Paso 1: Navegar y hacer login**
  await loginPage.navigate();
  await loginPage.login('svc-cptautomation@thermon.onmicrosoft.com', 'Fon48413');

  // **Paso 2: Navegar al dashboard y crear proyecto**
  await dashboardPage.navigateToDashboard();
  await dashboardPage.createProject();

  // **Paso 3: Rellenar detalles del proyecto**
  await projectPage.fillProjectDetails(projectName, projectNumber.toString(), projectDate);

  // **Paso 4: Completar la creación del proyecto**
  await projectPage.completeProjectCreation();

  // **Paso 5: Crear circuito**
  await projectPage.createCircuit();

  // **Paso 6: Validar que el proyecto se creó correctamente**
  await dashboardPage.navigateToDashboard();
  await dashboardPage.openProjectsInCache();

  await dashboardPage.selectProjectFromList(projectName);

  // **Paso 7: Abrir el proyecto**
  await page.getByText('Open Project').click();
  await page.waitForTimeout(2000);
});
